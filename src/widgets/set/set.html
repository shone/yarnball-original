<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="set-styles.html">

<link rel="import" href="../selector/selector.html">

<dom-module id="yb-set">

  <style include="set-styles"></style>

  <template>
    <div class="header">
      <yb-selector node-id="{{from}}"></yb-selector>
      <yb-selector node-id="{{via}}"></yb-selector>
      <yb-selector node-id="{{to}}"></yb-selector>
    </div>
    <div class="content">
      <template is="dom-repeat" items="{{nodes}}">
        <yb-node node-id="{{item}}"></yb-node>
      </template>
    </div>
  </template>
  
  <script>
    (function() {
      'use strict';
      
      Polymer({
        is: 'yb-set',
        properties: {
          via: {
            type: String,
          },
          to: {
            type: String,
          },
          nodes: {
            type: Array,
            value: []
          }
        },
        created: function() {
          var self = this;
          require(['client', 'node_id'], function(client, node_id) {
            function handleLinks(links) {
              links.forEach(function(link) {
                if (node_id.toHex(link.via) === self.via &&
                    node_id.toHex(link.to)  === self.to) {
                  
                  self.push('nodes', node_id.toHex(link.from));
                }
              });
            }
            handleLinks(client.web.getLinks());
            client.web.onLinks(handleLinks);
          });
        }
      });
    })();
  </script>

</dom-module>